sudo: required
language: go
go: '1.11'
env:
  global:
    - secure: "anvq4UtxiMw1S1ke4DB0QqPEC59FLYuH+2iXwUs2O1oyIGku71R4ZamOIC07X4Fr8wl/tR1+uUUUfb+5KpR/FnuUgO+jLoQXH1CsKOliUZIat2f2rTxuTqDu9KHVWLbv2Tft0VLvrc3MqHnhMwAor4Q6UqVomYz8w5RVwn+tSNsR+eL2fkqJHYRH0mv4sYriPLVHODdqGUdRKnoSwI7n3TcG9e2b6/zxuKTzO3Lt36UZLsA8U8Hbnv3TTirU6MkFx3sZBPwsXHBcYlgM076gYP/ohGCi+oqne1MQyzWqQTObXKBEz3VnQLaBIV7TGkQ5bNFVoj+44K06+NkvqJN6q8i8G704fKyd2frfFCLBoqrqykYkW9ZFJIXACj3AUBRKCimTrVrTWWWjfzTOY2Sj0VwsjGT+cnnyl7ZuHLdkPD53keTPDrk9f3kc4RytUIkCM/XXL2Z0MU5WNSq+wNHSvjxEvtWoWWVqw9UBBN8ivFyL94Xu/b6KG8tOzD/7cZgjgqsHot0taaBRbf/meXJ9Q3FGySY4OpxSO4NcK+9gpSdLY/2e6skjU+Og0Ba1HsA6xpAeUxl3z7DFiNS6qnZWA6tR+sBZzCIANm1qFa/bPljuLfPgINhi0JHsZymvsMETZfiDUls+7gQiYcgO68YDjBHF07kiuwmrkC88gotGyOE="
    - secure: lADiaVCTEw4QSDd3ZHtngGKdhDteUO+qfncDvGtYSf9nbHMyP/PsY2bLFo6y2C2UdfLzGaQhCmCbyAKtPSS+7XUE5+hplcZmZdFqyG+FUKzW9nEt7d5BmunSxs9UsPhbR6LvbeCdzrs/On3z4Bpg7diJYdo5ICv1fuR5Q3JYzuGTfukZ6onhmf6OZ4ZIJCwV8qCMde6zc8iGLpvj+Oysc1ya0aRvuXqIF+ixWWz5QqDUwvFnSd3a2NeuVeyesT3DPXRpQnCVPMuxROa7/IJa/rqZQPJkcLLzzibLeA8/f58/a3W27Etcdk26YwVdBJhTwwkyqBtl9HuxEBDJ/IsabqM8WDFVbSjBVWOBTmnQUC2KHI2Kfs6rtFtvX7LPbMM4xlF8GOssZO/ez0fYo1LcoxZtPdBJB7YVcU49XEm5z4OLcBr+3ChrXRTd2eL2fQuK+U7aN/MPjkS5W9umSsRypO9mTGY7lviff9QZfEwZJMOr9JFTt3LvDrW0QcwtMsW+vTTyhIvsN6TzYhLWqiUlSUMWP2wGYqbULbUCho9iJDt8shHs92eha9h+sdU2Dtft3HkqBi5AXhQRxfvMMnOxuwfT3gygkeOEwuMvZvuK/No1NX2BZAmCihOac5UMi8rFiS9Y23kxl5JrXEaVo+Qn9U43L57gRBS3N3yRYYA9xcQ=

before_install:
- curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
- sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu
  $(lsb_release -cs) stable"
- sudo apt-get update
- sudo apt-get -y install docker-ce
services:
- docker
jobs:
  include:
  - stage: ci-cd
    script: make ci
    before_deploy: echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    if: tag IS blank
    deploy:
    - provider: script
      skip_cleanup: true
      script: make cd BRANCH_NAME=${TRAVIS_BRANCH}
  - stage: release
    before_deploy: echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    if: tag IS NOT blank
    script: echo true
    deploy:
    - provider: script
      skip_cleanup: true
      script: make release
      on:
        tags: true
